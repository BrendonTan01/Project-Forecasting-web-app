# AGENTS.md

## Cursor Cloud specific instructions

### Overview

This is a single-product **Next.js 16 + Supabase** web application (Capacity Intelligence Platform). There is one service: a Next.js dev server on port 3000 backed by a local Supabase instance (PostgreSQL, Auth, Storage, etc.) running via Docker.

### Services

| Service | How to run | Port |
|---------|-----------|------|
| Next.js dev server | `npm run dev` | 3000 |
| Local Supabase | `npx supabase start` (requires Docker) | 54321 (API), 54322 (DB), 54323 (Studio) |

### Standard commands

See `package.json` scripts for lint/build/dev. See `README.md` for full setup instructions.

- **Lint**: `npm run lint`
- **Build**: `npm run build`
- **Dev**: `npm run dev`

### Gotchas

- **Docker is required** for local Supabase. The Docker daemon must be started (`sudo dockerd &`) and the socket must be accessible (`sudo chmod 666 /var/run/docker.sock`) before running `npx supabase start`. In the cloud VM, fuse-overlayfs storage driver and iptables-legacy are needed.
- **Seed SQL is broken**: The `supabase/seed.sql` references columns (`expected_revenue`, `manual_estimated_cost`, etc.) on `project_proposals` that were dropped by migration `20260225000004_proposal_labour_scope.sql`. Running `supabase db reset` with seeding enabled will fail. Workaround: start Supabase with seeding disabled in `supabase/config.toml` (`[db.seed] enabled = false`), then manually seed via psql, adjusting the project_proposals INSERT to use the current schema columns (`estimated_hours_per_week`, `office_scope`).
- **Supabase CLI v2.76+ key format**: Local Supabase now outputs `Publishable` and `Secret` key names (instead of `anon key` and `service_role key`). Use the `Publishable` value for `NEXT_PUBLIC_SUPABASE_ANON_KEY` and `Secret` for `SUPABASE_SERVICE_ROLE_KEY`.
- **Pre-existing lint errors**: The codebase has 3 pre-existing ESLint errors (React purity rules, prefer-const) and 4 warnings. `npm run lint` exits with code 1 due to these. This is not caused by your changes.
- **Test users** (password `TestPassword123!`): `admin@acme.com` (administrator), `manager.london@acme.com` / `manager.singapore@acme.com` (managers), `staff.engineer@acme.com` / `staff.designer@acme.com` / `staff.analyst@acme.com` / `staff.new@acme.com` (staff).
- The `supabase/config.toml` is auto-generated by `npx supabase init` and is gitignored. Each new environment needs to run `npx supabase init` if the file doesn't exist.
